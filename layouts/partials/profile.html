{{ $current := .RelPermalink }}
{{ $isReplies := or (eq .Section "reply") (hasPrefix $current "/replies") }}
{{ $isPosts := hasPrefix $current "/posts" }}
{{ $isNotes := hasPrefix $current "/notes" }}
{{ $currentNoSlash := strings.TrimSuffix "/" $current }}
{{ $defaultFollowURL := "https://micro.blog" }}
{{ with .Site.Author.username }}
  {{ $defaultFollowURL = printf "https://micro.blog/%s" . }}
{{ end }}
{{ $followURL := default $defaultFollowURL .Site.Params.alpine_follow_url }}
{{ $blueskyURL := default "https://bsky.app/profile/hunsanger.com" .Site.Params.alpine_bluesky_url }}
{{ $mastodonURL := default "https://social.lol/@hunsanger" .Site.Params.alpine_mastodon_url }}

<div class="cover"></div>

<section class="profile">
  <img class="avatar u-photo" src="{{ default "/favicon.ico" .Site.Author.avatar }}" alt="{{ .Site.Title }}" width="112" height="112" />
  <div class="profile-main">
    <h2 class="p-name">{{ .Site.Title }}</h2>
    {{ with .Site.Params.description }}
      <p class="subtitle">{{ . | plainify }}</p>
    {{ else }}
      <p class="subtitle">Thoughts, stories and ideas.</p>
    {{ end }}
  </div>

  <div class="profile-actions">
    <a class="social-icon-button" href="{{ $blueskyURL }}" target="_blank" rel="noopener noreferrer me" aria-label="Bluesky">
      <img class="social-icon-logo" src="https://api.iconify.design/simple-icons/bluesky.svg?color=%238d8d8d" alt="" aria-hidden="true" />
    </a>
    <a class="social-icon-button" href="{{ $mastodonURL }}" target="_blank" rel="noopener noreferrer me" aria-label="Mastodon">
      <img class="social-icon-logo" src="https://api.iconify.design/simple-icons/mastodon.svg?color=%238d8d8d" alt="" aria-hidden="true" />
    </a>
    <a class="follow-button" href="{{ $followURL }}" target="_blank" rel="noopener noreferrer">Follow</a>
  </div>
</section>

<nav class="tabs" aria-label="Sections">
  <a href="/" class="{{ if .IsHome }}active{{ end }}">All</a>
  <a href="/posts/" class="{{ if $isPosts }}active{{ end }}">Posts</a>
  <a href="/notes/" class="{{ if $isNotes }}active{{ end }}">Notes</a>
  <a href="/replies/" class="{{ if $isReplies }}active{{ end }}">Replies</a>

  {{ range .Site.Menus.main }}
    {{ $menuURL := .URL | relLangURL }}
    {{ $menuNoSlash := strings.TrimSuffix "/" $menuURL }}
    {{ $href := $menuURL | safeURL }}
    {{ with .Page }}
      {{ with .Params.redirect_url }}
        {{ $href = . }}
      {{ end }}
    {{ end }}
    {{ if and (ne $menuURL "/") (not (hasPrefix $menuURL "/posts")) (not (hasPrefix $menuURL "/replies")) (not (hasPrefix $menuURL "/notes")) (not (hasPrefix $menuURL "/archive")) (ne (lower .Name) "about") (ne (lower .Name) "gear") }}
      <a href="{{ $href }}" class="{{ if or (eq $currentNoSlash $menuNoSlash) (and (ne $menuNoSlash "") (hasPrefix $currentNoSlash (printf "%s/" $menuNoSlash))) }}active{{ end }}">{{ .Name }}</a>
    {{ end }}
  {{ end }}
</nav>
